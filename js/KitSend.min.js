function getNextField(a){for(var t=1;a.find("input[name="+t+"]").length;)t++;return t}function fancyOpen(a){return $.fancybox(a,{padding:0,fitToView:!1,scrolling:"no",beforeShow:function(){$(".fancybox-wrap").addClass("beforeShow"),device.mobile()||($("html").addClass("fancybox-lock"),$(".fancybox-overlay").html($(".fancybox-wrap")))},afterShow:function(){$(".fancybox-wrap").removeClass("beforeShow"),$(".fancybox-wrap").addClass("afterShow"),setTimeout(function(){$(".fancybox-wrap").css({position:"absolute"}),$(".fancybox-inner").css("height","auto")},200)},beforeClose:function(){$(".fancybox-wrap").removeClass("afterShow"),$(".fancybox-wrap").addClass("beforeClose")},afterClose:function(){$(".fancybox-wrap").removeClass("beforeClose"),$(".fancybox-wrap").addClass("afterClose")}}),!1}var customHandlers=[];$(document).ready(function(){var t=/^\+\d \(\d{3}\) \d{3}-\d{2}-\d{2}$/;function a(){var a=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;customHandlers.onScroll&&customHandlers.onScroll(a)}$.validator.addMethod("customPhone",function(a){return t.test(a)}),$(".ajax").parents("form").each(function(){$(this).validate({rules:{email:"email",phone:"customPhone"}}),$(this).find("input[name=phone]").length&&$(this).find("input[name=phone]").each(function(){if("function"==typeof IMask)new IMask($(this)[0],{mask:"+{7} (000) 000-00-00",prepare:function(a,t){return 8==a&&0==t._value.length?"+7 (":(tmp=a.match(/[\d\+]*/g),a=tmp&&tmp.length?tmp.join(""):"")}});else $(this).mask("+7 (999) 999-99-99")})}),$.extend($.validator.messages,{required:"Ошибка: значение не может быть пустым",email:"Ошибка: недопустимое значение",customPhone:"Ошибка: недопустимое значение"}),$(window).scroll(a),a(),$(".fancy:not(.fancy-binded)").each(function(){var t=$($(this).attr("href")),e=$(this);e.fancybox({padding:0,content:t,helpers:{overlay:{locked:!0}},closeExisting:!0,btnTpl:{smallBtn:'<button data-fancybox-close class="fancybox-close-small" title="Закрыть"></button>'},beforeShow:function(){if($(".fancybox-wrap").addClass("beforeShow"),t.find(".custom-field").remove(),e.attr("data-value")){var a=getNextField(t.find("form"));t.find("form").append("<input type='hidden' class='custom-field' name='"+a+"' value='"+e.attr("data-value")+"'/><input type='hidden' class='custom-field' name='"+a+"-name' value='"+e.attr("data-name")+"'/>")}t.attr("data-beforeShow")&&customHandlers[t.attr("data-beforeShow")]&&customHandlers[t.attr("data-beforeShow")](t)},afterShow:function(){$(".fancybox-wrap").removeClass("beforeShow"),$(".fancybox-wrap").addClass("afterShow"),t.attr("data-afterShow")&&customHandlers[t.attr("data-afterShow")]&&customHandlers[t.attr("data-afterShow")](t),t.find("input[type='text'],input[type='number'],textarea").eq(0).focus()},beforeClose:function(){$(".fancybox-wrap").removeClass("afterShow"),$(".fancybox-wrap").addClass("beforeClose"),t.attr("data-beforeClose")&&customHandlers[t.attr("data-beforeClose")]&&customHandlers[t.attr("data-beforeClose")](t)},afterClose:function(){$(".fancybox-wrap").removeClass("beforeClose"),$(".fancybox-wrap").addClass("afterClose"),t.attr("data-afterClose")&&customHandlers[t.attr("data-afterClose")]&&customHandlers[t.attr("data-afterClose")](t)}}),e.addClass("fancy-binded")});var e=!1;$("body").on("mouseup",".b-popup *, .b-popup",function(){e=!0}),$("body").on("mousedown",".fancybox-slide",function(){e=!1}).on("mouseup",".fancybox-slide",function(){e||$.fancybox.close()}),$(".b-go").click(function(){var a=$($(this).attr("data-block")),t=$(this).attr("data-offset")||0,e=$(this).attr("data-duration")||800;return $("body, html").animate({scrollTop:a.offset().top-t},e),!1}),$(".fancy-img").fancybox({padding:0}),$(".goal-click").click(function(){$(this).attr("data-goal")&&yaCounter12345678.reachGoal($(this).attr("data-goal"))}),$(".ajax").parents("form").submit(function(){if(0==$(this).find("input.error,select.error,textarea.error").length){var t=$(this);$(t.attr("data-block"));t.find(".ajax").attr("onclick","return false;"),t.attr("data-beforeAjax")&&customHandlers[t.attr("data-beforeAjax")]&&customHandlers[t.attr("data-beforeAjax")](t),t.attr("data-goal")&&yaCounter12345678.reachGoal(t.attr("data-goal")),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:t.serialize(),success:function(a){$link="1"==a?t.find(".b-thanks-link"):$(".b-error-link"),t.attr("data-afterAjax")&&customHandlers[t.attr("data-afterAjax")]&&customHandlers[t.attr("data-afterAjax")](t),$.fancybox.close(),$link.click()},error:function(){$.fancybox.close(),$(".b-error-link").click()},complete:function(){t.find(".ajax").removeAttr("onclick"),t.find("input[type=text],textarea").val("")}})}else $(this).find("input.error,select.error,textarea.error").eq(0).focus();return!1}),$("body").on("click",".ajax",function(){return $(this).parents("form").submit(),!1})});