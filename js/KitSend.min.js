function getNextField(a){for(var e=1;a.find("input[name="+e+"]").length;)e++;return e}function fancyOpen(a){return $.fancybox(a,{padding:0,fitToView:!1,scrolling:"no",beforeShow:function(){$(".fancybox-wrap").addClass("beforeShow"),device.mobile()||($("html").addClass("fancybox-lock"),$(".fancybox-overlay").html($(".fancybox-wrap")))},afterShow:function(){$(".fancybox-wrap").removeClass("beforeShow"),$(".fancybox-wrap").addClass("afterShow"),setTimeout(function(){$(".fancybox-wrap").css({position:"absolute"}),$(".fancybox-inner").css("height","auto")},200)},beforeClose:function(){$(".fancybox-wrap").removeClass("afterShow"),$(".fancybox-wrap").addClass("beforeClose")},afterClose:function(){$(".fancybox-wrap").removeClass("beforeClose"),$(".fancybox-wrap").addClass("afterClose")}}),!1}var customHandlers=[];$(document).ready(function(){var e=/^\+\d \(\d{3}\) \d{3}-\d{2}-\d{2}$/;function a(){var a=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;customHandlers.onScroll&&customHandlers.onScroll(a)}$.validator.addMethod("customPhone",function(a){return e.test(a)}),$(".ajax").parents("form").each(function(){$(this).validate({rules:{email:"email",phone:"customPhone"}}),$(this).find("input[name=phone]").length&&$(this).find("input[name=phone]").each(function(){if("function"==typeof IMask)new IMask($(this)[0],{mask:"+{7} (000) 000-00-00",prepare:function(a,e){return 8==a&&0==e._value.length?"+7 (":(tmp=a.match(/[\d\+]*/g),a=tmp&&tmp.length?tmp.join(""):"")}});else $(this).mask("+7 (999) 999-99-99")})}),$.extend($.validator.messages,{required:"Ошибка: значение не может быть пустым",email:"Ошибка: недопустимое значение",customPhone:"Ошибка: недопустимое значение"}),$(window).scroll(a),a(),$(".fancy:not(.fancy-binded)").each(function(){var e=$($(this).attr("href")),t=$(this);t.fancybox({padding:0,content:e,helpers:{overlay:{locked:!0}},closeExisting:!0,btnTpl:{smallBtn:'<button data-fancybox-close class="fancybox-close-small" title="Закрыть"></button>'},beforeShow:function(){if(t.hasClass("b-header-community")&&$(".b-btn-menu-mobile, .b-menu-mobile-window").removeClass("open"),$(".fancybox-wrap").addClass("beforeShow"),e.find(".custom-field").remove(),t.attr("data-value")){var a=getNextField(e.find("form"));e.find("form").append("<input type='hidden' class='custom-field' name='"+a+"' value='"+t.attr("data-value")+"'/><input type='hidden' class='custom-field' name='"+a+"-name' value='"+t.attr("data-name")+"'/>")}e.attr("data-beforeShow")&&customHandlers[e.attr("data-beforeShow")]&&customHandlers[e.attr("data-beforeShow")](e)},afterShow:function(){$(".fancybox-wrap").removeClass("beforeShow"),$(".fancybox-wrap").addClass("afterShow"),e.attr("data-afterShow")&&customHandlers[e.attr("data-afterShow")]&&customHandlers[e.attr("data-afterShow")](e),e.find("input[type='text'],input[type='number'],textarea").eq(0).focus()},beforeClose:function(){$(".fancybox-wrap").removeClass("afterShow"),$(".fancybox-wrap").addClass("beforeClose"),e.attr("data-beforeClose")&&customHandlers[e.attr("data-beforeClose")]&&customHandlers[e.attr("data-beforeClose")](e)},afterClose:function(){$(".fancybox-wrap").removeClass("beforeClose"),$(".fancybox-wrap").addClass("afterClose"),e.attr("data-afterClose")&&customHandlers[e.attr("data-afterClose")]&&customHandlers[e.attr("data-afterClose")](e)}}),t.addClass("fancy-binded")});var t=!1;function o(a,e,t){var o=$(a),n=t||(window.innerWidth<768?180:20);e=e||800;$("body, html").animate({scrollTop:o.offset().top-n},e)}$("body").on("mouseup",".b-popup *, .b-popup",function(){t=!0}),$("body").on("mousedown",".fancybox-slide",function(){t=!1}).on("mouseup",".fancybox-slide",function(){t||$.fancybox.close()}),$(".b-go, .b-sections-list a, .b-links-list li a").click(function(){return o($(this).attr("href"),$(this).attr("data-duration"),$(this).attr("data-offset")),!1}),$(".fancy-img").fancybox({padding:0}),$(".goal-click").click(function(){$(this).attr("data-goal")&&yaCounter12345678.reachGoal($(this).attr("data-goal"))}),$(".ajax").parents("form").submit(function(){if(0==$(this).find("input.error,select.error,textarea.error").length){var a=$(this);$(a.attr("data-block"));a.find(".ajax").attr("onclick","return false;"),a.attr("data-beforeAjax")&&customHandlers[a.attr("data-beforeAjax")]&&customHandlers[a.attr("data-beforeAjax")](a),a.attr("data-goal")&&yaCounter12345678.reachGoal(a.attr("data-goal")),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:a.serialize(),success:function(a){!function(a){if(function(a){var e=a+"";return e=(e=(e=e.replace(/\\["\\\/bfnrtu]/g,"@")).replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]")).replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e)}(a)){var e=JSON.parse(a);if("error"!=e.result&&void 0!==e.action)switch(e.action){case"questionSuccess":$(".b-question-form").hide(),$(".b-success").show(),o(".b-success",300);break;case"reload":window.location.reload()}}else $link="1"==a?$this.find(".b-thanks-link"):$(".b-error-link"),$link.click()}(a)},error:function(){$.fancybox.close(),$(".b-error-link").click()},complete:function(){a.find(".ajax").removeAttr("onclick"),a.find("input[type=text],textarea").val(""),a.find(".icon-clear").removeClass("show")}})}else $(this).find("input.error,select.error,textarea.error").eq(0).focus();return!1}),$("body").on("click",".ajax",function(){return $(this).parents("form").submit(),!1})});